{% extends "base.html" %}
{% block title %}Administration - Gestion de Prêts{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="page-title mb-0">
        <i class="bi bi-shield-lock-fill text-dark"></i> Administration
    </h1>
    <a href="{{ url_for('admin_logout') }}" class="btn btn-outline-dark">
        <i class="bi bi-box-arrow-right"></i> Déconnexion
    </a>
</div>

<!-- Statistiques rapides -->
<div class="row g-3 mb-4">
    <div class="col-6 col-md-3">
        <div class="stat-card bg-primary bg-opacity-10">
            <div class="number text-primary">{{ stats.personnes }}</div>
            <div class="label">Personnes</div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="stat-card bg-warning bg-opacity-10">
            <div class="number text-warning">{{ stats.prets_actifs }}</div>
            <div class="label">Prêts en cours</div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="stat-card bg-success bg-opacity-10">
            <div class="number text-success">{{ stats.prets_total }}</div>
            <div class="label">Prêts au total</div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="stat-card bg-info bg-opacity-10">
            <div class="number text-info">{{ stats.categories }}</div>
            <div class="label">Catégories matériel</div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="stat-card bg-secondary bg-opacity-10">
            <div class="number text-secondary">{{ stats.inventaire }}</div>
            <div class="label">Matériels inventoriés</div>
        </div>
    </div>
</div>

<!-- Actions d'administration -->
<div class="row g-4">
    <!-- Colonne gauche -->
    <div class="col-12 col-md-6">
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white py-3">
                <h5 class="mb-0"><i class="bi bi-gear-fill text-primary"></i> Réglages</h5>
            </div>
            <div class="list-group list-group-flush">
                <a href="{{ url_for('admin_reglages') }}" class="list-group-item list-group-item-action d-flex align-items-center py-3">
                    <i class="bi bi-sliders2 text-primary me-3 fs-4"></i>
                    <div>
                        <strong>Réglages généraux</strong>
                        <div class="text-muted small">Durée d'alerte ({{ duree_defaut }}{{ 'h' if unite_defaut == 'heures' else 'j' }}), mot de passe, réinitialisation</div>
                    </div>
                    <i class="bi bi-chevron-right ms-auto"></i>
                </a>
                <a href="{{ url_for('categories') }}" class="list-group-item list-group-item-action d-flex align-items-center py-3">
                    <i class="bi bi-tags-fill text-primary me-3 fs-4"></i>
                    <div>
                        <strong>Catégories de matériel</strong>
                        <div class="text-muted small">Gérer les catégories de suggestions rapides</div>
                    </div>
                    <i class="bi bi-chevron-right ms-auto"></i>
                </a>
                <a href="{{ url_for('inventaire') }}" class="list-group-item list-group-item-action d-flex align-items-center py-3">
                    <i class="bi bi-pc-display text-primary me-3 fs-4"></i>
                    <div>
                        <strong>Inventaire matériel</strong>
                        <div class="text-muted small">Gérer le parc matériel ({{ stats.inventaire }} matériel{{ 's' if stats.inventaire != 1 }})</div>
                    </div>
                    <i class="bi bi-chevron-right ms-auto"></i>
                </a>
                <a href="{{ url_for('categories_personnes_admin') }}" class="list-group-item list-group-item-action d-flex align-items-center py-3">
                    <i class="bi bi-person-lines-fill text-primary me-3 fs-4"></i>
                    <div>
                        <strong>Catégories de personnes</strong>
                        <div class="text-muted small">Gérer les catégories (élève, enseignant, agent…)</div>
                    </div>
                    <i class="bi bi-chevron-right ms-auto"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Colonne droite -->
    <div class="col-12 col-md-6">
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white py-3">
                <h5 class="mb-0"><i class="bi bi-arrow-left-right text-primary"></i> Import / Export</h5>
            </div>
            <div class="list-group list-group-flush">
                <a href="{{ url_for('importer_personnes') }}" class="list-group-item list-group-item-action d-flex align-items-center py-3">
                    <i class="bi bi-file-earmark-arrow-up-fill text-success me-3 fs-4"></i>
                    <div>
                        <strong>Importer des personnes</strong>
                        <div class="text-muted small">Charger un fichier CSV (élèves, enseignants…)</div>
                    </div>
                    <i class="bi bi-chevron-right ms-auto"></i>
                </a>
                <a href="{{ url_for('export_page') }}" class="list-group-item list-group-item-action d-flex align-items-center py-3">
                    <i class="bi bi-download text-info me-3 fs-4"></i>
                    <div>
                        <strong>Exporter des données</strong>
                        <div class="text-muted small">Personnes, prêts, alertes, inventaire au format CSV</div>
                    </div>
                    <i class="bi bi-chevron-right ms-auto"></i>
                </a>
                <a href="{{ url_for('importer_inventaire') }}" class="list-group-item list-group-item-action d-flex align-items-center py-3">
                    <i class="bi bi-file-earmark-arrow-up-fill text-warning me-3 fs-4"></i>
                    <div>
                        <strong>Importer l'inventaire</strong>
                        <div class="text-muted small">Charger un fichier CSV du parc matériel</div>
                    </div>
                    <i class="bi bi-chevron-right ms-auto"></i>
                </a>
            </div>
        </div>

        <!-- Outils -->
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white py-3">
                <h5 class="mb-0"><i class="bi bi-tools text-primary"></i> Outils</h5>
            </div>
            <div class="list-group list-group-flush">
                <button type="button" class="list-group-item list-group-item-action d-flex align-items-center py-3"
                        data-bs-toggle="modal" data-bs-target="#modalDemo">
                    <i class="bi bi-database-fill-gear text-secondary me-3 fs-4"></i>
                    <div>
                        <strong>Générer une base de démonstration</strong>
                        <div class="text-muted small">Créer ~20 personnes, ~20 matériels et des prêts de test</div>
                    </div>
                    <i class="bi bi-chevron-right ms-auto"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal confirmation démo -->
<div class="modal fade" id="modalDemo" tabindex="-1" aria-labelledby="modalDemoLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalDemoLabel">
                    <i class="bi bi-database-fill-gear"></i> Générer une base de démonstration
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
            </div>
            <div class="modal-body">
                <p>Cette action va ajouter des données fictives à la base existante :</p>
                <ul>
                    <li><strong>~20 personnes</strong> (élèves, enseignants, agents)</li>
                    <li><strong>~20 matériels</strong> (PC, tablettes, vidéoprojecteurs, casques…)</li>
                    <li><strong>~15 prêts</strong> (en cours + retournés)</li>
                </ul>
                <div class="alert alert-warning mb-0">
                    <i class="bi bi-exclamation-triangle-fill"></i>
                    Les données existantes ne seront <strong>pas supprimées</strong>. Les données de démo s'ajouteront à celles déjà présentes.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                <form action="{{ url_for('admin_generer_demo') }}" method="POST" class="d-inline">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-play-fill"></i> Générer
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
