<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fiche de pr√™t - PretGo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; font-size: 13px; color: #333; padding: 12mm; }
        .header { text-align: center; border-bottom: 3px solid #0d6efd; padding-bottom: 10px; margin-bottom: 15px; }
        .header h1 { font-size: 20px; color: #0d6efd; margin-bottom: 3px; }
        .header .etablissement { font-size: 14px; color: #666; }
        .header .ref { font-size: 11px; color: #888; margin-top: 3px; }
        .section { margin-bottom: 12px; }
        .section h2 { font-size: 14px; background: #f0f4f8; padding: 5px 10px; border-left: 4px solid #0d6efd; margin-bottom: 8px; }
        .field { display: flex; margin-bottom: 5px; }
        .field .label { width: 160px; font-weight: bold; color: #555; flex-shrink: 0; font-size: 12px; }
        .field .value { flex: 1; border-bottom: 1px solid #ddd; min-height: 18px; padding-left: 5px; font-size: 12px; }
        table.items { width: 100%; border-collapse: collapse; margin-top: 5px; }
        table.items th { background: #f0f4f8; padding: 5px 8px; text-align: left; font-size: 12px; border: 1px solid #ddd; }
        table.items td { padding: 5px 8px; border: 1px solid #ddd; font-size: 12px; }
        .engagement { border: 2px solid #0d6efd; border-radius: 6px; padding: 10px; margin: 15px 0; background: #f8f9ff; }
        .engagement p { font-size: 11px; line-height: 1.4; }
        .signatures { display: flex; gap: 30px; margin-top: 15px; }
        .signatures .sig-box { flex: 1; text-align: center; }
        .signatures .sig-box .sig-label { font-weight: bold; margin-bottom: 3px; font-size: 11px; }
        .signatures .sig-box .sig-area { border: 1px solid #ccc; height: 55px; border-radius: 4px; background: #fafafa; }
        .signatures .sig-box .sig-date { font-size: 10px; color: #888; margin-top: 3px; }
        .footer { text-align: center; margin-top: 15px; font-size: 10px; color: #aaa; border-top: 1px solid #eee; padding-top: 5px; }
        @media print {
            body { padding: 8mm; }
            .no-print { display: none !important; }
            @page { size: A4; margin: 8mm; }
        }
    </style>
</head>
<body>
    <div class="no-print" style="text-align:center; margin-bottom:20px;">
        <button onclick="window.print()" style="padding:10px 30px;font-size:16px;cursor:pointer;background:#0d6efd;color:white;border:none;border-radius:6px;">
            üñ®Ô∏è Imprimer cette fiche
        </button>
        <button onclick="window.close()" style="padding:10px 20px;font-size:14px;cursor:pointer;background:#6c757d;color:white;border:none;border-radius:6px;margin-left:10px;">
            Fermer
        </button>
    </div>

    <div class="header">
        {% if nom_etablissement %}<div class="etablissement">{{ nom_etablissement }}</div>{% endif %}
        <h1>FICHE DE PR√äT DE MAT√âRIEL</h1>
        <div class="ref">R√©f√©rence : PRET-{{ pret.id }} ‚Äî {{ pret.date_emprunt | format_date }}</div>
    </div>

    <div class="section">
        <h2>Emprunteur</h2>
        <div class="field">
            <div class="label">Nom et pr√©nom :</div>
            <div class="value">{{ pret.nom }} {{ pret.prenom }}</div>
        </div>
        <div class="field">
            <div class="label">Cat√©gorie :</div>
            <div class="value">{{ pret.categorie | label_categorie }}</div>
        </div>
        {% if pret.classe %}
        <div class="field">
            <div class="label">Classe / Service :</div>
            <div class="value">{{ pret.classe }}</div>
        </div>
        {% endif %}
    </div>

    <div class="section">
        <h2>Mat√©riel pr√™t√©</h2>
        {% if pret_items %}
        <table class="items">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Description</th>
                    <th>N¬∞ inventaire</th>
                    <th>N¬∞ s√©rie</th>
                </tr>
            </thead>
            <tbody>
                {% for item in pret_items %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ item.description }}</td>
                    <td>{{ item.numero_inventaire or '‚Äî' }}</td>
                    <td>{{ item.numero_serie or '‚Äî' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="field">
            <div class="label">Description :</div>
            <div class="value">{{ pret.descriptif_objets }}</div>
        </div>
        {% endif %}
    </div>

    <div class="section">
        <h2>Conditions du pr√™t</h2>
        <div class="field">
            <div class="label">Date d'emprunt :</div>
            <div class="value">{{ pret.date_emprunt | format_date }}</div>
        </div>
        <div class="field">
            <div class="label">Dur√©e pr√©vue :</div>
            <div class="value">{{ pret | format_duree }}</div>
        </div>
        {% if pret.lieu_nom %}
        <div class="field">
            <div class="label">Lieu :</div>
            <div class="value">{{ pret.lieu_nom }}</div>
        </div>
        {% endif %}
        {% if pret.notes %}
        <div class="field">
            <div class="label">Observations :</div>
            <div class="value">{{ pret.notes }}</div>
        </div>
        {% endif %}
    </div>

    <div class="engagement">
        <p><strong>Engagement de l'emprunteur :</strong> Je soussign√©(e) <strong>{{ pret.nom }} {{ pret.prenom }}</strong>,
        reconnais avoir re√ßu le mat√©riel d√©crit ci-dessus en bon √©tat de fonctionnement.
        Je m'engage √† le restituer dans le m√™me √©tat d√®s que je n'en aurai plus l'usage,
        et au plus tard √† la date de retour pr√©vue. En cas de d√©gradation, perte ou vol,
        je m'engage √† en informer imm√©diatement le service de pr√™t.</p>
    </div>

    <div class="signatures">
        <div class="sig-box">
            <div class="sig-label">Signature de l'emprunteur</div>
            <div class="sig-area"></div>
            <div class="sig-date">Date : ___/___/______</div>
        </div>
        <div class="sig-box">
            <div class="sig-label">Signature du responsable</div>
            <div class="sig-area"></div>
            <div class="sig-date">Date : ___/___/______</div>
        </div>
    </div>

    {% if pret.date_retour %}
    <div class="section" style="margin-top:15px;">
        <h2>Retour</h2>
        <div class="field">
            <div class="label">Date de retour :</div>
            <div class="value">{{ pret.date_retour | format_date }}</div>
        </div>
        <div class="signatures" style="margin-top:10px;">
            <div class="sig-box">
                <div class="sig-label">Signature de l'emprunteur</div>
                <div class="sig-area"></div>
            </div>
            <div class="sig-box">
                <div class="sig-label">Signature du responsable</div>
                <div class="sig-area"></div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="footer">
        PretGo ‚Äî Fiche g√©n√©r√©e le {{ now().strftime('%d/%m/%Y √† %H:%M') }}
    </div>
</body>
</html>
